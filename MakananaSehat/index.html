<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Petualangan Makanan Sehat</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="style/favicon.ico">
    <!-- Style Lokal -->
    <link href="style/bootstrap.min.css" rel="stylesheet">
    <link href="style/fontawesome/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <style>
        :root {
            --primary-color: #5cb85c; 
            --success-color: #8bc34a;
            --warning-color: #ff9800; 
            --info-color: #03a9f4; 
            --bg-color: #f1f8e9;
            --white: #ffffff;
            --dark-text: #333333;
            --black: #000000;
            --danger-color: #e53935;
            --blue-official: #2d89ef; 

            --font-title: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            --font-body: 'Arial', sans-serif;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: var(--font-body);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #dcedc8, #fff9c4); 
            color: var(--dark-text);
            -webkit-user-select: none;
            user-select: none;
            overflow: hidden;
        }
        
        #game-container {
            width: 95%;
            max-width: 1500px;
            height: 95vh;
            max-height: 4000px;
            background: var(--bg-color);
            border-radius: 30px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1), 0 6px 6px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border: 20px solid var(--white);
            position: relative;  
            z-index: 1;
        }

        /* --- STYLES UNTUK INTRO POPUP (SPLASH SCREEN) --- */
        #intro-splash {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(255, 255, 255, 0.98); /* Background putih bersih hampir solid */
            z-index: 9999; /* Paling depan */
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 1;
            transition: opacity 0.8s ease-out;
            padding: 20px;
        }
        
        #intro-splash.fade-out {
            opacity: 0;
            pointer-events: none;
        }

        .splash-card {
            background: #fff;
            width: 100%;
            max-width: 1100px;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
            border: 1px solid #eee;
            position: relative;
            text-align: center;
            animation: slideUpFade 1s cubic-bezier(0.2, 0.8, 0.2, 1);
            overflow: hidden; /* Untuk watermark */
        }

        /* Watermark Logo */
        .splash-watermark {
            position: absolute;
            top: 50%;
            right: 5%;
            transform: translateY(-50%);
            width: 400px;
            opacity: 0.05;
            pointer-events: none;
            z-index: 0;
        }

        .splash-header {
            position: relative;
            z-index: 2;
            margin-bottom: 2rem;
            border-bottom: 3px solid #d4a017; /* Garis emas */
            padding-bottom: 20px;
        }

        .tut-wuri-logo {
            width: 100px;
            margin-bottom: 15px;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));
            animation: floatLogo 3s ease-in-out infinite;
        }

        .splash-header h2 {
            font-family: var(--font-title);
            font-weight: 800;
            font-size: 1.4rem;
            color: #000;
            margin: 5px 0;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .splash-header h3 {
            font-family: var(--font-title);
            font-weight: 700;
            font-size: 1rem;
            color: #444;
            margin: 0;
            text-transform: uppercase;
        }

        .splash-content-grid {
            position: relative;
            z-index: 2;
            display: grid;
            grid-template-columns: 200px 1fr;
            gap: 15px;
            text-align: left;
            font-family: 'Segoe UI', sans-serif;
            font-size: 1rem;
            color: var(--blue-official); /* Warna biru teks */
        }

        .splash-label {
            font-weight: bold;
            color: #5ea4f3; /* Biru lebih terang untuk label */
        }

        .splash-value {
            color: #444;
            font-weight: 500;
        }

        .splash-footer {
            margin-top: 30px;
            position: relative;
            z-index: 2;
            text-align: left;
            display: grid;
            grid-template-columns: 200px 1fr;
            gap: 15px;
        }

        .close-splash {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 2rem;
            color: var(--danger-color);
            cursor: pointer;
            z-index: 10;
            transition: transform 0.2s;
            background: none;
            border: none;
        }
        .close-splash:hover {
            transform: scale(1.2) rotate(90deg);
        }

        @keyframes slideUpFade {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes floatLogo {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* Responsiveness untuk Splash */
        @media (max-width: 768px) {
            .splash-content-grid, .splash-footer {
                grid-template-columns: 1fr;
                gap: 5px;
            }
            .splash-label { margin-top: 10px; }
            .splash-card { padding: 20px; overflow-y: auto; max-height: 90vh; }
            .splash-watermark { width: 200px; opacity: 0.03; }
        }

        /* --- END SPLASH STYLES --- */

        /* SCREEN STYLES (Perbaikan Klik) */
        .screen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 2rem;
            height: 100%;
            /* Posisi absolute membuat layar menumpuk */
            position: absolute;
            width: 100%; top: 0; left: 0;
            
            /* Default State (Visible) */
            opacity: 1;
            visibility: visible; /* Pastikan terlihat */
            z-index: 10; /* Layer aktif */
            transition: opacity 0.4s ease-in-out, transform 0.4s ease-in-out, visibility 0.4s;
            pointer-events: auto; /* Pastikan bisa diklik */
        }

        /* State Hidden (Perbaikan: visibility hidden agar tidak memblokir klik) */
        .screen.hidden {
            opacity: 0;
            visibility: hidden; /* Benar-benar hilangkan dari hit-test mouse */
            transform: scale(0.95);
            pointer-events: none; /* Matikan klik */
            z-index: -1; /* Pindahkan ke belakang */
        }

        .screen h1 {
            font-family: var(--font-title);
            font-weight: bold; /* Menambahkan bold karena font standar */
            font-size: clamp(2.5rem, 8vw, 4.5rem);
            color: var(--primary-color);
            text-shadow:
                -2px -2px 0 var(--white), 
                2px -2px 0 var(--white),  
                -2px 2px 0 var(--white),   
                2px 2px 0 var(--white),     
                0 -2px 0 var(--white),   
                0 2px 0 var(--white),     
                -2px 0 0 var(--white),   
                2px 0 0 var(--white),     
                -3px -3px 0 var(--white),
                3px -3px 0 var(--white),
                -3px 3px 0 var(--white),
                3px 3px 0 var(--white),
                4px 4px 0 rgba(0,0,0,0.1);  
            margin-bottom: 1rem;
        }
        .screen p {
            font-size: clamp(0.9rem, 3vw, 1.2rem);
            margin-bottom: 1.5rem;
            max-width: 1000px;
        }

        /* Button Style */
        .btn {
            font-family: var(--font-title);
            font-weight: bold;
            padding: 1rem 2.5rem;
            font-size: 1.5rem;
            cursor: pointer;
            border: none;
            color: var(--white);
            border-radius: 15px;
            background: var(--primary-color);
            border-bottom: 6px solid #388e3c; 
            transition: all 0.1s ease-in-out;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            pointer-events: auto; 
            position: relative;
            z-index: 20;
        }
        .btn:hover {
            transform: translateY(-2px);
            filter: brightness(1.1);
        }
        .btn:active {
            transform: translateY(2px);
            border-bottom-width: 2px;
        }
        #retry-button {
            background: var(--warning-color);
            border-bottom-color: #f57c00;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            width: 100%;
            max-width: 700px;
            margin-bottom: 2rem;
            position: relative;
            z-index: 20;
        }
        
        @media (min-width: 768px) {
            .menu-grid {
                grid-template-columns: repeat(5, 1fr);
            }
        }
        
        @media (max-width: 767px) {
            .menu-grid {
                grid-template-columns: repeat(2, 1fr);
                max-width: 400px;
            }
            #sumber-btn {
                grid-column: 1 / -1;
            }
        }


        .btn-small {
            font-size: 1rem;
            padding: 0.75rem 1rem;
            color: var(--white);
            background-color: var(--info-color);
            border-bottom: 4px solid #0288d1;
        }
        .btn-small:active {
             border-bottom-width: 2px;
        }
        #sumber-btn {
            background-color: #9c27b0;
            border-bottom-color: #7b1fa2;
        }

        #game-screen { justify-content: flex-start; }
        #hud {
            display: flex;
            justify-content: space-between;
            width: 100%;
            padding: 0.75rem 1.25rem;
            font-family: var(--font-title);
            font-weight: bold;
            font-size: 1.3rem;
            background-color: var(--white);
            border-radius: 15px;
            margin-bottom: 1rem;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
            border: 2px solid #e0e0e0;
        }
        #hud span { color: var(--primary-color); }
        #timer-display.low-time {
            color: var(--danger-color);
            animation: pulse 1s infinite;
        }
        
        #game-area { flex-grow: 1; width: 100%; position: relative; }
        .level-content { width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; }
        .level-content h2 { font-family: var(--font-title); font-weight: bold; margin-bottom: 1rem; font-size: 1.5rem; color: var(--dark-text);}

        /* LEVEL 1: MENJODOHKAN */
        .matching-container { 
            display: flex; 
            flex-direction: row; 
            justify-content: center; 
            gap: clamp(2rem, 10vw, 6rem); 
            width: 100%; 
            flex-grow: 1; 
            align-items: center; 
        }
        .column { 
            display: flex; 
            flex-direction: column; 
            gap: 0.5rem; 
        }
        .island-box, .region-box {
            width: clamp(90px, 22vw, 130px);
            height: clamp(90px, 22vw, 130px);
            border: 3px solid #ced4da;
            border-radius: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s ease;
            background-color: var(--white);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 10px;
            color: var(--dark-text);
            pointer-events: auto;
        }
        .region-box { 
            font-family: var(--font-title);
            font-weight: bold; 
            font-size: clamp(1rem, 3vw, 1.4rem); 
            background-color: #f9fbe7;
            text-align: center;
        }
        .island-box i { 
            font-size: clamp(3rem, 8vw, 4rem);
            pointer-events: none; 
        }
        
        .selected { border-color: var(--warning-color); transform: scale(1.08); box-shadow: 0 6px 12px rgba(0,0,0,0.15); background-color: #fff3e0;}
        .matched { opacity: 0.5; background-color: #dcedc8; border-color: var(--success-color); pointer-events: none; transition: opacity 0.5s, background-color 0.5s; }
        .wrong { animation: shake 0.5s; border-color: var(--danger-color); }
        
        /* LEVEL 2: HUJAN MAKANAN */
        #level-2 p { font-size: 1.2rem; }
        #target-region-name { color: var(--danger-color); font-weight: 700; font-size: 1.4rem; text-transform: uppercase; }
        #rain-area { width: 100%; height: 100%; overflow: hidden; position: relative; background: linear-gradient(#e0f7fa, #ffffff); border-radius: 16px; margin-top: 10px; border: 2px dashed #b2ebf2; }
        .falling-island { 
            position: absolute; 
            width: clamp(70px, 15vw, 100px); 
            height: clamp(70px, 15vw, 100px); 
            cursor: pointer; 
            animation: fall linear forwards; 
            display: flex;
            justify-content: center;
            align-items: center;
            background: white;
            border-radius: 50%;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            pointer-events: auto;
            z-index: 5;
        }
        .falling-island i { font-size: clamp(2.5rem, 6vw, 3.5rem); pointer-events: none; }
        .falling-island.caught { transform: scale(0); opacity: 0; transition: 0.2s; }
        

        /* LEVEL 3: MEMORY GAME */
        #level-3 { justify-content: center; }
        #level-3 p { font-size: 1.1rem; max-width: 500px; margin-top: -0.5rem; margin-bottom: 1rem; }
        #memory-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: clamp(10px, 2vw, 16px);
            width: 100%;
            max-width: 500px;
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.5);
            border-radius: 16px;
            perspective: 1200px;
        }
        .card {
            aspect-ratio: 1 / 1;
            position: relative;
            cursor: pointer;
            transform-style: preserve-3d;
            transition: transform 0.6s, box-shadow 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            pointer-events: auto;
        }
        .card:hover:not(.matched) { transform: translateY(-5px); box-shadow: 0 4px 10px rgba(0,0,0,0.15); }
        .card.flipped { transform: rotateY(180deg); }
        
        .card-face { position: absolute; width: 100%; height: 100%; -webkit-backface-visibility: hidden; backface-visibility: hidden; display: flex; justify-content: center; align-items: center; border-radius: 12px; }
        .card-front {
            background: linear-gradient(135deg, var(--warning-color), #ffcc80);
            font-family: var(--font-title);
            font-weight: bold;
            font-size: 3em;
            color: white;
            text-shadow: 2px 2px 3px rgba(0,0,0,0.2);
        }
        .card-back { 
            background-color: #fff; 
            transform: rotateY(180deg); 
            padding: 5px; 
            font-family: var(--font-title);
            font-weight: bold;
            font-size: clamp(1rem, 4vw, 1.5rem);
            line-height: 1.2;
            text-align: center;
            color: var(--dark-text);
            border: 2px solid var(--warning-color);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .card-back i { font-size: 2.5em; margin-bottom: 5px; }
        .card.matched .card-front { background: linear-gradient(135deg, var(--success-color), #81c784); }

        /* LEVEL 4: KUIS */
        #level-4 {
            overflow-y: auto;
            padding: 2rem 1rem;
        }
        #level-4 h2 {
            margin-top: 0;
            margin-bottom: 1.5rem;
            font-size: clamp(1.5rem, 5vw, 2rem);
            flex-shrink: 0;
        }
        #level-4 .question-text {
            font-size: clamp(1rem, 2.8vw, 1.6rem);
            margin-bottom: 1.5rem;
            max-width: 1200px;
            line-height: 1.5;
            padding: 0 1rem;
            flex-shrink: 0;
        }
        #level-4 .options-grid {
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            gap: 1rem;
            width: 100%;
            max-width: 800px;
            padding: 0 1rem 2rem 1rem;
        }

        @media (min-width: 768px) {
            #level-4 .options-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (min-width: 992px) {
            .matching-container {
                flex-direction: column;
                justify-content: center;
                gap: 2.5rem;
            }
            .column {
                flex-direction: row;
                gap: 1.5rem;
                flex-wrap: wrap;
                justify-content: center;
            }
            .island-box, .region-box {
                width: 140px;
                height: 140px;
            }
        }


        #level-4 .option-btn {
            font-family: var(--font-body);
            padding: 1.2rem 2rem;
            font-size: clamp(0.9rem, 2.2vw, 1.2rem);
            cursor: pointer;
            border: none;
            color: var(--dark-text);
            border-radius: 12px;
            background: #fff;
            border: 2px solid #e0e0e0;
            border-bottom: 5px solid #e0e0e0;
            transition: all 0.1s ease-in-out;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            pointer-events: auto;
        }
        #level-4 .option-btn:hover {
            transform: translateY(-2px);
            border-color: var(--info-color);
            background-color: #e1f5fe;
        }
        #level-4 .option-btn:active {
            transform: translateY(2px);
            border-bottom-width: 2px;
        }
        #level-4 .option-btn.correct {
            background-color: var(--success-color);
            border-color: #4caf50;
            border-bottom-color: #388e3c;
            color: var(--white);
        }
        #level-4 .option-btn.incorrect {
            background-color: var(--danger-color);
            border-color: #f44336;
            border-bottom-color: #d32f2f;
            color: var(--white);
        }
        
        /* MODAL STYLES */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex; justify-content: center; align-items: center;
            z-index: 1000;
            opacity: 0; pointer-events: none;
            visibility: hidden; /* Fix: Defaultnya hidden */
            transition: opacity 0.3s ease;
        }
        .modal-overlay:not(.hidden) { opacity: 1; pointer-events: auto; visibility: visible; }
        .modal-content {
            background: var(--white);
            /* UPDATE WARNA TEKS MODAL AGAR HITAM */
            color: #000000;
            padding: 2rem; border-radius: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            position: relative;
            max-width: 90%; width: 1000px;
            transform: scale(0.9);
            transition: transform 0.3s ease;
            text-align: left;
            max-height: 80vh;
            overflow-y: auto;
        }
        .modal-overlay:not(.hidden) .modal-content { transform: scale(1); }
        .close-modal {
            position: absolute; top: 15px; right: 20px;
            font-size: 2.5rem; color: #aaa;
            cursor: pointer; font-weight: bold;
            line-height: 1;
        }
        .close-modal:hover { color: var(--dark-text); }
        .modal-content h2 { font-family: var(--font-title); font-weight: bold; margin-bottom: 1rem; color: var(--primary-color);}
        .modal-content p { font-size: 1rem; margin-bottom: 0.75rem; color: #000000; } /* Pastikan paragraf hitam */
        .modal-content ul {
            list-style-position: inside;
            margin-left: 1rem;
            margin-bottom: 1rem;
            color: #000000; /* Pastikan list hitam */
        }
        .modal-content li { margin-bottom: 0.5rem; }
        .modal-content a {
            color: var(--info-color);
            text-decoration: none;
        }
        .modal-content a:hover { text-decoration: underline; }

        .video-container {
            position: relative;
            padding-bottom: 56.25%;
            height: 0;
            overflow: hidden;
            width: 100%;
            background: #000;
            border-radius: 10px;
        }
        .video-container iframe {
            position: absolute;
            top: 0; left: 0;
            width: 100%;
            height: 100%;
        }

        /* PROFIL MODAL */
        .profile-modal {
            background: linear-gradient(135deg, #66bb6a, #43a047); /* Green Gradient */
            color: white; /* Tetap putih karena background hijau */
            overflow: hidden;
        }
        .profile-modal .modal-content p { color: white; } /* Override hitam kembali ke putih untuk profil */
        
        .modal-main-content { display: flex; align-items: center; }
        .profile-pic-container { 
            width: 150px; height: 150px; /* Made square for cleaner look */
            margin-right: 25px;
            border-radius: 50%;
            border: 4px solid white;
            overflow: hidden;
            flex-shrink: 0;
        }
        .profile-pic-container img {
            width: 100%; height: 100%; object-fit: cover;
            transition: transform 0.3s ease;
        }
        .profile-pic-container img:hover { transform: scale(1.1); }
        .profile-text h2 {
            font-family: var(--font-title);
            font-weight: bold;
            font-size: 1.8em;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.4);
        }
        .profile-text p { font-size: 0.9em; margin: 5px 0; color: white !important; } /* Paksa putih untuk teks profil */
        .profile-text .kontak { font-weight: bold; margin-top: 15px; }
        .social-icons { font-size: 1.8em; display: flex; gap: 20px; }
        .social-icons a { color: white; text-decoration: none; transition: transform 0.2s; }
        .social-icons a:hover { transform: scale(1.2); }
        .profile-bg-img {
            position: absolute; right: -30px; top: -30px;
            height: 130%; opacity: 0.1;
            pointer-events: none; z-index: -1;
        }
        .profile-modal .close-modal { color: white; }

        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        @keyframes fall { from { top: -80px; transform: rotate(0deg); } to { top: 110%; transform: rotate(360deg); } }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
    </style>
</head>
<body>

    <!-- INTRO SPLASH SCREEN -->
    <div id="intro-splash">
        <div class="splash-card">
            <button class="close-splash" id="closeSplashBtn" title="Tutup">
                <i class="fas fa-times"></i>
            </button>
            
            <img src="style/favicon.ico" alt="Watermark Logo" class="splash-watermark">

            <div class="splash-header">
                <img src="style/favicon.ico" alt="Tut Wuri Handayani" class="tut-wuri-logo">
                <h2>DIREKTORAT SEKOLAH DASAR</h2>
                <h3>KEMENTERIAN PENDIDIKAN DASAR DAN MENENGAH</h3>
                <h4 style="font-size: 0.9rem; font-weight: normal; margin-top: 5px;">DIREKTORAT JENDERAL PENDIDIKAN ANAK USIA DINI, PENDIDIKAN DASAR DAN PENDIDIKAN MENENGAH</h4>
            </div>

            <div class="splash-content-grid">
                <div class="splash-label">Pengarah :</div>
                <div class="splash-value">Moch. Salim Somad, S.Kom., M.Pd., Direktorat Sekolah Dasar</div>

                <div class="splash-label">Penanggung Jawab :</div>
                <div class="splash-value">Lanny Anggraini, S.Pd., M.A., Direktorat Sekolah Dasar</div>

                <div class="splash-label">Pengembang :</div>
                <div class="splash-value">Fenti Sanubari, M.Pd</div>

                <div class="splash-label">Pengkaji Materi :</div>
                <div class="splash-value">Kurator, MBG</div>

                <div class="splash-label">Pengkaji Media :</div>
                <div class="splash-value">
                    1. Muh. Noor Ginanjar Jaelani, S.Pd., Direktorat Sekolah Dasar<br>
                    2. Ine Rahmawati, S.Pd., M.Si., Direktorat Sekolah Dasar
                </div>
            </div>

            <div class="splash-footer">
                <div class="splash-label">Diterbitkan oleh :</div>
                <div class="splash-value">
                    Direktorat Sekolah Dasar<br>
                    Direktorat Jenderal Pendidikan Anak Usia Dini, Pendidikan Dasar, dan Pendidikan Menengah<br>
                    Kementerian Pendidikan Dasar dan Menengah<br>
                    Tahun 2025
                </div>
            </div>
        </div>
    </div>
    
    <div id="game-container">
        
        <div id="start-screen" class="screen">
            <h1>Zona Makanan Sehat</h1>
            <p>Ayo belajar tentang gizi dan makanan sehat dengan cara yang seru!</p>
            <div class="menu-grid">
                <button id="petunjuk-btn" class="btn btn-small">Petunjuk</button>
                <button id="tujuan-btn" class="btn btn-small">Tujuan</button>
                <button id="materi-btn" class="btn btn-small">Materi</button>
                <button id="pengembang-btn" class="btn btn-small">Profil</button>
                <button id="sumber-btn" class="btn btn-small">Sumber</button> </div>
            <button id="start-button" class="btn">Mulai Petualangan!</button>
        </div>

        <div id="game-screen" class="screen hidden">
            <div id="hud">
                <p>Level: <span id="level-display">1</span></p>
                <p>Waktu: <span id="timer-display">20</span></p>
            </div>
            <div id="game-area">
                <!-- Level 1: Menjodohkan (Updated Layout) -->
                <div id="level-1" class="level-content" style="display: none;">
                    <h2>Level 1: Jodohkan Makanan & Kandungannya!</h2>
                    <div class="matching-container">
                        <div id="islands-column" class="column"></div>
                        <div id="regions-column" class="column"></div>
                    </div>
                </div>
                
                <!-- Level 2: Tangkap Makanan (Updated) -->
                <div id="level-2" class="level-content" style="display: none;">
                    <h2>Level 2: Tangkap Sumber Gizi!</h2>
                    <p>Klik makanan yang mengandung: <strong id="target-region-name"></strong></p>
                    <div id="rain-area"></div>
                </div>

                <!-- Level 3: Memory Game (Updated) -->
                <div id="level-3" class="level-content" style="display: none;">
                    <h2>Level 3: Memory Gizi</h2>
                    <p>Temukan pasangan Gambar Makanan dan Nama Kandungan Gizinya!</p>
                    <div id="memory-grid"></div>
                </div>

                <!-- Level 4: Kuis (Updated) -->
                <div id="level-4" class="level-content" style="display: none;">
                    <h2>Level 4: Kuis Pengetahuan Gizi</h2>
                    <p class="question-text" id="time-question-text"></p>
                    <div id="time-options-grid" class="options-grid"></div>
                </div>
            </div>
        </div>

        <div id="end-screen" class="screen hidden">
            <h1 id="end-title"></h1>
            <p id="end-message"></p>
            <button id="retry-button" class="btn">Main Lagi</button>
            <br>
            <a href="https://sites.google.com/view/bangbinedu/home" target="_blank"><button class="btn" ><i style="color: white; text-decoration: none;"><i class="fa fa-home"></i></button></a>
        </div>
    </div>

    <!-- Modals -->
    <div id="petunjukModal" class="modal-overlay hidden">
        <div class="modal-content">
            <span class="close-modal">√ó</span>
            <h2>Petunjuk Permainan</h2>
            <p><strong>Level 1:</strong> Klik gambar makanan, lalu klik kotak kandungan gizinya (Karbohidrat, Protein, atau Vitamin).</p>
            <p><strong>Level 2:</strong> Perhatikan perintah di atas, lalu klik makanan yang jatuh sesuai kategori yang diminta.</p>
            <p><strong>Level 3:</strong> Buka dua kartu untuk menemukan pasangan gambar makanan dan nama gizinya.</p>
            <p><strong>Level 4:</strong> Jawablah pertanyaan pilihan ganda seputar kesehatan dan manfaat makanan.</p>
        </div>
    </div>

    <div id="tujuanModal" class="modal-overlay hidden">
        <div class="modal-content">
            <span class="close-modal">√ó</span>
            <h2>Tujuan Pembelajaran</h2>
            <p>1. Siswa dapat mengenali jenis-jenis makanan sehat.</p>
            <p>2. Siswa dapat mengelompokkan makanan berdasarkan kandungan gizinya (Karbohidrat, Protein, Vitamin).</p>
            <p>3. Siswa memahami manfaat makanan sehat bagi tubuh.</p>
        </div>
    </div>
    
    <div id="materiModal" class="modal-overlay hidden">
        <div class="modal-content">
            <span class="close-modal">√ó</span>
            <h2 style="text-align: center;"><i class="fas fa-book-reader" style="color: var(--primary-color);"></i> Materi Belajar</h2>
            
            <div style="line-height: 1.6;">
                <!-- Intro -->
                <p style="text-align: center; font-style: italic;">
                    "Halo Adik-adik! Tubuh kita seperti mobil, butuh bahan bakar yang bagus agar bisa melaju kencang!"
                </p>
                <hr style="border-top: 2px dashed #ccc;">

                <!-- Bagian 1: Pencernaan -->
                <h4 style="color: var(--success-color); font-weight: bold; margin-top: 15px;">
                    <i class="fas fa-broom"></i> Makanan Pembersih Perut (Pencernaan)
                </h4>
                <p>Supaya perut tidak sakit dan buang air besar lancar, kita butuh <strong>Serat</strong> dan <strong>Air</strong>:</p>
                <ul style="list-style: none; padding-left: 5px;">
                    <li style="margin-bottom: 8px;">
                        <i class="fas fa-leaf" style="color: green; width: 25px; text-align: center;"></i> 
                        <strong>Sayuran Hijau:</strong> Seperti sapu ajaib yang membersihkan usus kita.
                    </li>
                    <li style="margin-bottom: 8px;">
                        <i class="fas fa-apple-alt" style="color: red; width: 25px; text-align: center;"></i> 
                        <strong>Buah Pepaya & Pisang:</strong> Membuat perut nyaman dan tidak sembelit.
                    </li>
                    <li style="margin-bottom: 8px;">
                        <i class="fas fa-tint" style="color: blue; width: 25px; text-align: center;"></i> 
                        <strong>Air Putih:</strong> Minum 8 gelas sehari biar pencernaan lancar seperti seluncuran air!
                    </li>
                </ul>

                <!-- Bagian 2: Manfaat Tubuh -->
                <h4 style="color: var(--warning-color); font-weight: bold; margin-top: 20px;">
                    <i class="fas fa-running"></i> Makanan Penambah Kekuatan
                </h4>
                <p>Supaya tubuh tumbuh tinggi dan kuat, kita butuh gizi ini:</p>
                <ul style="list-style: none; padding-left: 5px;">
                    <li style="margin-bottom: 8px;">
                        <i class="fas fa-egg" style="color: orange; width: 25px; text-align: center;"></i> 
                        <strong>Telur & Ikan (Protein):</strong> Membangun otot supaya kita kuat berlari dan bermain.
                    </li>
                    <li style="margin-bottom: 8px;">
                        <i class="fas fa-bone" style="color: #5bc0de; width: 25px; text-align: center;"></i> 
                        <strong>Susu & Keju (Kalsium):</strong> Membuat tulang dan gigi kita keras dan tidak mudah patah.
                    </li>
                    <li style="margin-bottom: 8px;">
                        <i class="fas fa-carrot" style="color: #e67e22; width: 25px; text-align: center;"></i> 
                        <strong>Wortel (Vitamin A):</strong> Membuat mata kita jernih dan sehat.
                    </li>
                </ul>

                <div style="background-color: #f1f8e9; padding: 10px; border-radius: 10px; margin-top: 15px; text-align: center; border: 2px solid var(--success-color);">
                    <i class="fas fa-smile-wink" style="color: var(--success-color); font-size: 1.5rem;"></i><br>
                    <strong>Ingat ya!</strong> Kurangi makan permen dan keripik, perbanyak makan buah dan sayur!
                </div>
            </div>
        </div>
    </div>

    <div id="profilModal" class="modal-overlay hidden">
        <div class="modal-content profile-modal">
            <span class="close-modal">√ó</span>
            <div class="modal-main-content">
                <div class="profile-pic-container">
                    <!-- GANTI GAMBAR PROFIL DI SINI -->
                    <img id="profileImage" src="style/Fenti.jpg" alt="Foto Profil">
                </div>
                <div class="profile-text">
                    <h2>FENTI SANUBARI, M.Pd</h2>
                    <p>SDN Lubang Buaya 01, Jakarta Timur</p>
                    <p class="kontak">Kontak:</p>
                    <div class="social-icons">
                        <a href="https://www.facebook.com/bintang.a.permana.1/" target="_blank"><i class="fab fa-facebook"></i></a>
                        <a href="https://www.youtube.com/@Bangbin_1" target="_blank"><i class="fab fa-youtube"></i></a>
                        <a href="https://wa.me/6282125700117" target="_blank"><i class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
            </div>
            <!-- Background Decoration -->
            <i class="fas fa-leaf profile-bg-img" style="font-size: 20rem; color: white;"></i>
        </div>
    </div>
    
    <div id="sumberModal" class="modal-overlay hidden">
        <div class="modal-content">
            <span class="close-modal">√ó</span>
            <h2>Sumber & Atribusi</h2>
            <p><strong>Ikon:</strong></p>
            <ul>
                <li>Semua ikon makanan menggunakan <a href="https://fontawesome.com/" target="_blank">Font Awesome 5</a>.</li>
            </ul>
            <p><strong>Materi:</strong></p>
            <ul>
                <li>Materi gizi dasar tingkat Sekolah Dasar (Kementerian Kesehatan RI).</li>
            </ul>
            <p><strong>Framework:</strong></p>
            <ul>
                <li>Bootstrap (CSS Only) untuk tata letak dasar.</li>
            </ul>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- SPLASH SCREEN LOGIC ---
            const splashScreen = document.getElementById('intro-splash');
            const closeSplashBtn = document.getElementById('closeSplashBtn');
            let splashTimeout;

            // Fungsi menutup splash
            const closeSplash = () => {
                splashScreen.classList.add('fade-out');
                // Hapus element dari DOM setelah animasi selesai agar tidak menutupi apapun
                setTimeout(() => {
                    if (splashScreen.parentNode) {
                        splashScreen.parentNode.removeChild(splashScreen);
                    }
                }, 800);
            };

            // Event Listener Tombol Tutup
            if (closeSplashBtn) {
                closeSplashBtn.addEventListener('click', closeSplash);
            }

            // Auto close setelah 3 MENIT (180.000 ms) sesuai permintaan
            splashTimeout = setTimeout(closeSplash, 3000);

            // --- END SPLASH SCREEN LOGIC ---


            const foods = [
                { 
                    name: 'Nasi', 
                    kategori: 'Karbohidrat', 
                    icon: '<i class="fas fa-utensils" style="color: #A1887F;"></i>' // Nasi/Makanan Pokok
                },
                { 
                    name: 'Roti', 
                    kategori: 'Karbohidrat', 
                    icon: '<i class="fas fa-bread-slice" style="color: #D7CCC8;"></i>' 
                },
                { 
                    name: 'Ikan', 
                    kategori: 'Protein', 
                    icon: '<i class="fas fa-fish" style="color: #90CAF9;"></i>' 
                },
                { 
                    name: 'Telur', 
                    kategori: 'Protein', 
                    icon: '<i class="fas fa-egg" style="color: #FFECB3;"></i>' 
                },
                { 
                    name: 'Apel', 
                    kategori: 'Vitamin', 
                    icon: '<i class="fas fa-apple-alt" style="color: #ef5350;"></i>' 
                },
                { 
                    name: 'Wortel', 
                    kategori: 'Vitamin', 
                    icon: '<i class="fas fa-carrot" style="color: #ff9800;"></i>' 
                },
                { 
                    name: 'Daun/Sayur', 
                    kategori: 'Vitamin', 
                    icon: '<i class="fas fa-leaf" style="color: #66bb6a;"></i>' 
                },
                 { 
                    name: 'Lemon', 
                    kategori: 'Vitamin', 
                    icon: '<i class="fas fa-lemon" style="color: #ffeb3b;"></i>' 
                }
            ];
            
            // Ambil kategori unik
            const categories = [...new Set(foods.map(a => a.kategori))];

            // Data untuk Level 4 (Kuis Gizi)
            const nutritionQuestions = [
                {
                    id: 1,
                    question: "Zat gizi manakah yang berfungsi sebagai sumber energi utama bagi tubuh?",
                    answer: "Karbohidrat",
                    options: ["Karbohidrat", "Vitamin", "Protein", "Air"]
                },
                {
                    id: 2,
                    question: "Wortel banyak mengandung vitamin A yang sangat baik untuk kesehatan...",
                    answer: "Mata",
                    options: ["Tulang", "Mata", "Gigi", "Kulit"]
                },
                {
                    id: 3,
                    question: "Makanan manakah di bawah ini yang merupakan sumber Protein?",
                    answer: "Ikan dan Telur",
                    options: ["Nasi dan Roti", "Ikan dan Telur", "Apel dan Jeruk", "Permen dan Cokelat"]
                },
                {
                    id: 4,
                    question: "Apa akibatnya jika kita kekurangan minum air putih?",
                    answer: "Dehidrasi",
                    options: ["Kenyang", "Dehidrasi", "Semangat", "Gemuk"]
                },
                {
                    id: 5,
                    question: "Susu adalah minuman sehat yang banyak mengandung Kalsium untuk kekuatan...",
                    answer: "Tulang dan Gigi",
                    options: ["Rambut", "Kuku", "Tulang dan Gigi", "Mata"]
                }
            ];


            const allScreens = document.querySelectorAll('.screen');
            const startScreen = document.getElementById('start-screen');
            const gameScreen = document.getElementById('game-screen');
            const endScreen = document.getElementById('end-screen');
            const startButton = document.getElementById('start-button');
            const retryButton = document.getElementById('retry-button');
            const levelDisplay = document.getElementById('level-display');
            const timerDisplay = document.getElementById('timer-display');
            const levelContents = document.querySelectorAll('.level-content');

            // Modal Elements
            const petunjukBtn = document.getElementById('petunjuk-btn');
            const tujuanBtn = document.getElementById('tujuan-btn');
            const pengembangBtn = document.getElementById('pengembang-btn');
            const materiBtn = document.getElementById('materi-btn');
            const sumberBtn = document.getElementById('sumber-btn'); 
            const petunjukModal = document.getElementById('petunjukModal');
            const tujuanModal = document.getElementById('tujuanModal');
            const profilModal = document.getElementById('profilModal');
            const materiModal = document.getElementById('materiModal');
            const sumberModal = document.getElementById('sumberModal'); 
            const allModals = document.querySelectorAll('.modal-overlay');
            
            let currentLevel = 1, timer, timeLeft = 0, gameInterval;
            let audioCtx, correctSound, wrongSound, clickSound, levelUpSound;
            let currentQuestionIndex = 0; 
            let audioInitialized = false; 

            const levelTimers = {
                1: 40, 
                2: 25, 
                3: 50, 
                4: 120 
            };

            // FUNGSI SUARA TOMBOL (HOVER)
            const playSoundEffect = () => {
                const audio = new Audio('style/Klik.mp3');
                audio.play().catch(e => console.warn("Audio play failed:", e));
            };

            // Helper untuk menambahkan suara hover ke elemen
            const addHoverSound = (element) => {
                if(element) element.addEventListener('mouseenter', playSoundEffect);
            };

            // Terapkan suara hover ke tombol-tombol yang sudah ada saat loading
            document.querySelectorAll('button, .btn, .btn-small, .close-modal').forEach(btn => {
                addHoverSound(btn);
            });

            // =================================
            // AUDIO SYSTEM
            // =================================
            function initAudio() {
                if (audioInitialized) return;
                try {
                    const AudioContext = window.AudioContext || window.webkitAudioContext;
                    
                    // Setup Audio Context for Level Up (still generated)
                    if (AudioContext) {
                        audioCtx = new AudioContext();
                        const createSound = (freq, type, duration) => {
                            if (!audioCtx) return () => {};
                            return () => {
                                if (audioCtx.state === 'suspended') audioCtx.resume();
                                try {
                                    const oscillator = audioCtx.createOscillator();
                                    const gainNode = audioCtx.createGain();
                                    oscillator.connect(gainNode);
                                    gainNode.connect(audioCtx.destination);
                                    oscillator.type = type;
                                    oscillator.frequency.value = freq;
                                    gainNode.gain.setValueAtTime(0, audioCtx.currentTime);
                                    gainNode.gain.linearRampToValueAtTime(0.3, audioCtx.currentTime + 0.01);
                                    oscillator.start(audioCtx.currentTime);
                                    gainNode.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + duration);
                                    oscillator.stop(audioCtx.currentTime + duration);
                                } catch (e) { console.error("Sound play failed:", e); }
                            };
                        };
                        levelUpSound = createSound(800, 'triangle', 0.4);
                    }
                    
                    // GANTI SOUND EFFECT JAWABAN BENAR & SALAH
                    correctSound = () => {
                        const audio = new Audio('style/bangbinWin.mp3');
                        audio.play().catch(e => console.warn("Audio play failed:", e));
                    };
                    
                    wrongSound = () => {
                        const audio = new Audio('style/bangbinSalah.mp3');
                        audio.play().catch(e => console.warn("Audio play failed:", e));
                    };
                    
                    audioInitialized = true;
                } catch(e) {
                    console.error("Audio context error:", e);
                }
            }
            
            // =================================
            // GAME STATE CONTROL
            // =================================
            function resetGameStates() {
                clearInterval(timer);
                clearInterval(gameInterval);
                currentLevel = 1;
                timeLeft = 0;
                currentQuestionIndex = 0;
                timerDisplay.textContent = 0;
                timerDisplay.classList.remove('low-time');
                levelDisplay.textContent = 1;
                levelContents.forEach(el => el.style.display = 'none');

                // Cleanup Dynamic Elements
                const rainArea = document.getElementById('rain-area');
                if (rainArea) rainArea.innerHTML = '';
                const memoryGrid = document.getElementById('memory-grid');
                if (memoryGrid) memoryGrid.innerHTML = '';
                const islandsColumn = document.getElementById('islands-column');
                if (islandsColumn) islandsColumn.innerHTML = '';
                const regionsColumn = document.getElementById('regions-column');
                if (regionsColumn) regionsColumn.innerHTML = '';
                const optionsGridElement = document.getElementById('time-options-grid');
                if (optionsGridElement) optionsGridElement.innerHTML = '';
                
                document.querySelectorAll('.selected, .matched, .wrong').forEach(el => {
                    el.classList.remove('selected', 'matched', 'wrong');
                });
            }

            function switchScreen(screenToShow) {
                allScreens.forEach(screen => screen.classList.add('hidden'));
                screenToShow.classList.remove('hidden');
            }

            function startGame() {
                resetGameStates();
                // Inisialisasi audio saat interaksi pengguna pertama kali
                initAudio(); 
                
                switchScreen(gameScreen);
                startLevel();
            }

            function startLevel() {
                levelContents.forEach(el => el.style.display = 'none');
                levelDisplay.textContent = currentLevel;
                clearInterval(timer); 
                clearInterval(gameInterval); 

                timeLeft = levelTimers[currentLevel];

                if (currentLevel === 1) setupLevel1();
                else if (currentLevel === 2) setupLevel2();
                else if (currentLevel === 3) setupLevel3();
                else if (currentLevel === 4) setupLevel4();
                
                resetTimer();
                timer = setInterval(updateTimer, 1000);
            }

            function nextLevel() {
                clearInterval(timer);
                if (gameInterval) clearInterval(gameInterval);
                
                currentLevel++;
                if (levelUpSound) levelUpSound();

                if (currentLevel > 4) {
                    showEndScreen(true);
                } else {
                    startLevel();
                }
            }

            function levelFailed(reason = 'Waktu Habis!') {
                clearInterval(timer);
                if (gameInterval) clearInterval(gameInterval);
                if (wrongSound) wrongSound();
                showEndScreen(false, reason);
            }

            function showEndScreen(isWin, reason) {
                switchScreen(endScreen);
                const endTitle = document.getElementById('end-title');
                const endMessage = document.getElementById('end-message');
                if (isWin) {
                    endTitle.textContent = "üéâ Luar Biasa! Kamu Sehat! üéâ";
                    endTitle.style.color = "var(--success-color)";
                    endMessage.textContent = "Kamu telah menguasai pengetahuan tentang makanan sehat.";
                } else {
                    endTitle.textContent = "üçé Jangan Menyerah! ü•¶";
                    endTitle.style.color = "var(--warning-color)";
                    endMessage.textContent = `Kamu berhenti di Level ${currentLevel}. ${reason}`;
                }
            }

            function resetTimer() {
                timerDisplay.textContent = timeLeft;
                timerDisplay.classList.remove('low-time');
            }

            function updateTimer() {
                timeLeft--;
                timerDisplay.textContent = timeLeft;
                if (timeLeft <= 5) {
                    timerDisplay.classList.add('low-time');
                }
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    levelFailed();
                }
            }
            
            function shuffle(array) { return array.sort(() => Math.random() - 0.5); }

            // =================================
            // LEVEL 1: MENJODOHKAN (Food -> Category)
            // =================================
            function animateFly(fromElement, toElement, callback) {
                const flyingClone = fromElement.cloneNode(true);
                flyingClone.style.position = 'absolute';
                flyingClone.style.margin = 0;
                flyingClone.style.zIndex = 100;

                const startRect = fromElement.getBoundingClientRect();
                const endRect = toElement.getBoundingClientRect();
                const gameAreaRect = document.getElementById('game-area').getBoundingClientRect();

                flyingClone.style.left = `${startRect.left - gameAreaRect.left}px`;
                flyingClone.style.top = `${startRect.top - gameAreaRect.top}px`;
                flyingClone.style.width = `${startRect.width}px`;
                flyingClone.style.height = `${startRect.height}px`;
                flyingClone.style.backgroundColor = getComputedStyle(fromElement).backgroundColor;
                flyingClone.classList.add('island-box'); // Ensure styling matches
                
                document.getElementById('game-area').appendChild(flyingClone);
                
                requestAnimationFrame(() => {
                    flyingClone.style.transition = 'all 0.6s ease-in-out';
                    flyingClone.style.left = `${endRect.left - gameAreaRect.left + (endRect.width / 4)}px`;
                    flyingClone.style.top = `${endRect.top - gameAreaRect.top + (endRect.height / 4)}px`;
                    flyingClone.style.transform = 'scale(0.2)';
                    flyingClone.style.opacity = '0';
                });
                
                setTimeout(() => {
                    flyingClone.remove();
                    if (callback) callback();
                }, 600);
            }
            
            function setupLevel1() {
                document.getElementById('level-1').style.display = 'flex';
                const islandsColumn = document.getElementById('islands-column');
                const regionsColumn = document.getElementById('regions-column');
                islandsColumn.innerHTML = '';
                regionsColumn.innerHTML = '';

                // Pilih 4 makanan acak
                const levelFoods = shuffle([...foods]).slice(0, 4);
                // Pastikan kategori yang muncul sesuai dengan makanan yang terpilih
                const levelCategories = [...new Set(levelFoods.map(a => a.kategori))];

                shuffle(levelFoods).forEach(food => islandsColumn.appendChild(createBox('island-box', food.name, food.icon, food.kategori)));
                shuffle(levelCategories).forEach(cat => regionsColumn.appendChild(createBox('region-box', cat, cat, cat)));

                let selectedFood = null, selectedCategory = null, matchedCount = 0;

                function createBox(type, name, content, category) {
                    const div = document.createElement('div');
                    div.className = type;
                    div.innerHTML = content;
                    div.dataset.name = name;
                    div.dataset.kategori = category;
                    div.addEventListener('click', onBoxClick);
                    
                    // Add hover sound to islands/regions (optional but makes it interactive)
                    addHoverSound(div);
                    return div;
                }

                function onBoxClick(e) {
                    const box = e.currentTarget;
                    if (box.classList.contains('matched')) return;
                    // Note: clickSound removed from here, relying on hover and correct/wrong logic

                    if (box.classList.contains('island-box')) {
                        if (selectedFood) selectedFood.classList.remove('selected');
                        selectedFood = box;
                    } else { // region-box
                        if (selectedCategory) selectedCategory.classList.remove('selected');
                        selectedCategory = box;
                    }
                    box.classList.add('selected');
                    
                    if (selectedFood && selectedCategory) {
                        // Cek kecocokan
                        if (selectedFood.dataset.kategori === selectedCategory.dataset.kategori) {
                            if (correctSound) correctSound();
                            const currentFood = selectedFood;
                            const currentCat = selectedCategory;
                            
                            currentFood.classList.remove('selected');
                            currentCat.classList.remove('selected');
                            
                            animateFly(currentFood, currentCat, () => {
                                currentFood.classList.add('matched');
                                currentFood.style.visibility = 'hidden'; // Hide original
                                matchedCount++;
                                if (matchedCount === levelFoods.length) {
                                    document.querySelectorAll('.region-box').forEach(hb => hb.classList.add('matched'));
                                    setTimeout(nextLevel, 500);
                                }
                            });

                            selectedFood = null;
                            selectedCategory = null;
                        } else {
                            if (wrongSound) wrongSound();
                            const tempFood = selectedFood, tempCat = selectedCategory;
                            selectedFood = null; selectedCategory = null;
                            tempFood.classList.add('wrong'); tempCat.classList.add('wrong');
                            setTimeout(() => {
                                tempFood.classList.remove('selected', 'wrong');
                                tempCat.classList.remove('selected', 'wrong');
                            }, 500);
                        }
                    }
                }
            }

            // =================================
            // LEVEL 2: HUJAN MAKANAN
            // =================================
            function setupLevel2() {
                document.getElementById('level-2').style.display = 'flex';
                const rainArea = document.getElementById('rain-area');
                rainArea.innerHTML = '';
                
                const targetCategory = categories[Math.floor(Math.random() * categories.length)];
                document.getElementById('target-region-name').textContent = targetCategory;

                function createFallingFood() {
                    if (currentLevel !== 2) return;
                    
                    const foodData = foods[Math.floor(Math.random() * foods.length)];
                    const foodDiv = document.createElement('div');
                    foodDiv.className = 'falling-island'; // Pakai class lama untuk animasi
                    foodDiv.innerHTML = foodData.icon;
                    foodDiv.style.left = `${Math.random() * (rainArea.offsetWidth - 100)}px`;
                    
                    // Random speed
                    const speed = Math.random() * 2 + 3; // 3-5 seconds
                    foodDiv.style.animationDuration = `${speed}s`;

                    foodDiv.addEventListener('click', () => {
                        const isCorrect = foodData.kategori === targetCategory;
                        
                        if (isCorrect) {
                            if (correctSound) correctSound();
                            foodDiv.classList.add('caught');
                            setTimeout(nextLevel, 300);
                        } else {
                            levelFailed('Ups! Itu bukan sumber ' + targetCategory);
                        }
                    }, { once: true });
                    
                    rainArea.appendChild(foodDiv);
                    
                    // Clean up
                    setTimeout(() => { 
                        if (foodDiv && foodDiv.parentNode === rainArea) {
                            foodDiv.remove(); 
                        }
                    }, speed * 1000);
                }
                
                gameInterval = setInterval(createFallingFood, 800);
            }

            // =================================
            // LEVEL 3: MEMORY GAME (Food Icon <-> Category Name)
            // =================================
            function setupLevel3() {
                document.getElementById('level-3').style.display = 'flex';
                const grid = document.getElementById('memory-grid');
                grid.innerHTML = '';
                
                // Pilih 4 pasang
                const levelFoods = shuffle([...foods]).slice(0, 4);
                let cardItems = [];
                
                levelFoods.forEach((food, index) => {
                    // Item 1: Icon Makanan
                    cardItems.push({ 
                        type: 'icon', 
                        content: food.icon, 
                        pairId: index 
                    });
                    // Item 2: Teks Kategori (atau Nama Makanan - mari gunakan Nama Zat Gizi untuk edukasi)
                    cardItems.push({ 
                        type: 'text', 
                        content: `<span style="font-size:0.6em; display:block;">${food.name}</span><strong>${food.kategori}</strong>`, 
                        pairId: index 
                    });
                });
                
                let cardData = shuffle(cardItems);
                let flippedCards = [], matchedPairs = 0, lockBoard = false;

                cardData.forEach(item => {
                    const card = document.createElement('div');
                    card.className = 'card';
                    card.dataset.pairId = item.pairId;
                    
                    const backContent = item.type === 'icon' 
                        ? item.content 
                        : `<div style="display:flex; flex-direction:column; align-items:center;">${item.content}</div>`;

                    card.innerHTML = `
                        <div class="card-face card-front"><i class="fas fa-question"></i></div>
                        <div class="card-face card-back">${backContent}</div>
                    `;
                    grid.appendChild(card);
                    
                    // Optional: Hover sound on cards
                    addHoverSound(card);

                    card.addEventListener('click', () => {
                        if (lockBoard || card.classList.contains('flipped') || card.classList.contains('matched')) return;
                        // Click sound removed, replaced by card flip visual/logic
                        card.classList.add('flipped');
                        flippedCards.push(card);

                        if (flippedCards.length === 2) {
                            lockBoard = true;
                            const [card1, card2] = flippedCards;

                            if (card1.dataset.pairId === card2.dataset.pairId) { // Match!
                                if (correctSound) correctSound();
                                card1.classList.add('matched');
                                card2.classList.add('matched');
                                matchedPairs++;
                                flippedCards = [];
                                
                                setTimeout(() => {
                                    const checkmark = '<i class="fas fa-check" style="color:white;"></i>';
                                    card1.querySelector('.card-front').innerHTML = checkmark;
                                    card2.querySelector('.card-front').innerHTML = checkmark;
                                    lockBoard = false;
                                }, 500);

                                if (matchedPairs === levelFoods.length) {
                                    setTimeout(nextLevel, 1200);
                                }

                            } else { // No match
                                if (wrongSound) wrongSound();
                                setTimeout(() => {
                                    card1.classList.remove('flipped');
                                    card2.classList.remove('flipped');
                                    flippedCards = [];
                                    lockBoard = false;
                                }, 1000);
                            }
                        }
                    });
                });
            }

            // =================================
            // LEVEL 4: KUIS GIZI
            // =================================
            function setupLevel4() {
                document.getElementById('level-4').style.display = 'flex';
                const questionTextElement = document.getElementById('time-question-text');
                const optionsGridElement = document.getElementById('time-options-grid');
                optionsGridElement.innerHTML = '';

                if (currentQuestionIndex >= nutritionQuestions.length) {
                    nextLevel(); 
                    return;
                }

                const currentQuestion = nutritionQuestions[currentQuestionIndex];
                questionTextElement.textContent = currentQuestion.question;

                const shuffledOptions = shuffle([...currentQuestion.options]);

                shuffledOptions.forEach(option => {
                    const button = document.createElement('button');
                    button.className = 'option-btn';
                    button.textContent = option;
                    
                    // Add Hover Sound to Dynamic Buttons
                    addHoverSound(button);

                    button.addEventListener('click', () => {
                        handleQuizAnswer(button, option, currentQuestion.answer);
                    });
                    optionsGridElement.appendChild(button);
                });
            }

            function handleQuizAnswer(clickedButton, selectedOption, correctAnswer) {
                // Click sound removed here as per request "harusnya ketika kursor mendekat"

                document.querySelectorAll('#time-options-grid .option-btn').forEach(btn => {
                    btn.disabled = true;
                    if (btn.textContent === correctAnswer) {
                        btn.classList.add('correct');
                    }
                });

                if (selectedOption === correctAnswer) {
                    if (correctSound) correctSound();
                    clickedButton.classList.add('correct');
                    setTimeout(() => {
                        currentQuestionIndex++;
                        startLevel();
                    }, 1200);
                } else {
                    if (wrongSound) wrongSound();
                    clickedButton.classList.add('incorrect');
                    setTimeout(() => {
                        levelFailed('Jawabanmu salah, belajar lagi ya!');
                    }, 1200);
                }
            }

            // =================================
            // MODAL HANDLERS
            // =================================
            function openModal(modal) {
                // Click sound removed from here
                modal.classList.remove('hidden');
            }
            function closeModal() {
                allModals.forEach(modal => {
                    modal.classList.add('hidden');
                    const iframe = modal.querySelector('iframe');
                    if (iframe) {
                        const iframeSrc = iframe.src;
                        iframe.src = '';
                        iframe.src = iframeSrc;
                    }
                });
            }

            petunjukBtn.addEventListener('click', () => openModal(petunjukModal));
            tujuanBtn.addEventListener('click', () => openModal(tujuanModal));
            pengembangBtn.addEventListener('click', () => openModal(profilModal));
            materiBtn.addEventListener('click', () => openModal(materiModal));
            sumberBtn.addEventListener('click', () => openModal(sumberModal));
            
            allModals.forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target.classList.contains('modal-overlay') || e.target.classList.contains('close-modal')) {
                        // Click sound removed from close action
                        closeModal();
                    }
                });
            });

            startButton.addEventListener('click', () => {
                initAudio(); // Pastikan audio siap
                // Click sound removed
                startGame();
            });

            retryButton.addEventListener('click', () => {
                // Click sound removed
                startGame();
            });

            const homeBtn = document.querySelector('a[href="https://sites.google.com/view/bangbinedu/home"] button');
            if (homeBtn) {
                 // Add Hover Sound to Home Btn
                 addHoverSound(homeBtn);
                 homeBtn.addEventListener('click', (e) => {
                    // Click sound removed
                    resetGameStates();
                    switchScreen(startScreen);
                });
            }
        });
    </script>
</body>
</html>